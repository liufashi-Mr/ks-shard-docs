# @ks-console/shared 组件库介绍

## 概述

`@ks-console/shared` 是 KubeSphere 控制台的核心共享组件库，为 KubeSphere 平台提供了一套完整的、可复用的 React 组件和工具函数。该库专门为 Kubernetes 和云原生应用管理场景设计，包含了丰富的 UI 组件、状态管理、工具函数和自定义 Hooks。

## 版本信息

- **当前版本**: `0.0.0-canary.20250617082329`
- **许可证**: SEE LICENSE IN LICENSE
- **模块类型**: ES Module
- **TypeScript 支持**: 完整支持

## 核心特性

### 🎯 **专为 Kubernetes 设计**
- 内置 Kubernetes 资源管理组件
- 支持 Pod、Deployment、Service 等核心资源
- 提供集群、项目、工作空间管理功能

### 🧩 **丰富的 UI 组件**
- 数据表格和列表组件
- 模态框和确认对话框
- 状态指示器和进度条
- 图表和监控组件
- 布局和导航组件

### 🔧 **强大的工具函数**
- API 请求和数据处理
- 表单验证和格式化
- 时间处理和状态管理
- 文件操作和编码转换

### 🎣 **自定义 Hooks**
- 列表数据管理
- WebSocket 连接
- 模态框控制
- 缓存管理

## 主要模块

### 1. 组件 (Components)

#### 数据展示组件
- **DataTable**: 功能强大的数据表格组件
- **List**: 列表组件，支持分页和搜索
- **RankTable**: 排名表格组件
- **Pagination**: 分页组件

#### 状态和指示器
- **StatusIndicator**: 状态指示器，支持多种状态显示
- **StatusReason**: 状态原因展示
- **PodIndicator**: Pod 状态指示器
- **VolumeStatus**: 存储卷状态

#### 布局组件
- **WorkspaceLayout**: 工作空间布局
- **ProjectLayout**: 项目布局
- **DetailPage**: 详情页面布局
- **ListPage**: 列表页面布局

#### 输入组件
- **Inputs**: 各种输入组件
- **TimeSelector**: 时间选择器
- **UrlInput**: URL 输入框
- **TextPreview**: 文本预览

#### 模态框组件
- **Confirm**: 确认对话框
- **DeleteConfirm**: 删除确认
- **EditYamlModal**: YAML 编辑模态框
- **ContainerTerminal**: 容器终端

#### 其他组件
- **Avatar**: 头像组件
- **Image**: 图片组件
- **Lightbox**: 图片查看器
- **Markdown**: Markdown 渲染器
- **Terminal**: 终端组件

### 2. Hooks

#### 数据管理
- **useList**: 列表数据管理
- **useDataTable**: 数据表格管理
- **useListQueryParams**: 查询参数管理

#### 状态管理
- **useModal**: 模态框状态管理
- **useCache**: 缓存管理
- **useEventEmitter**: 事件发射器

#### 业务逻辑
- **useActions**: 操作管理
- **useActionMenu**: 操作菜单
- **useWorkspaceSelect**: 工作空间选择
- **useProjectSelect**: 项目选择

#### 网络和通信
- **useWebSocket**: WebSocket 连接
- **useUrl**: URL 管理
- **useInterval**: 定时器管理

### 3. 工具函数 (Utils)

#### API 和网络
- **request**: HTTP 请求工具
- **apis**: API 接口定义
- **websocket.client**: WebSocket 客户端

#### 数据处理
- **formatter**: 数据格式化
- **parser**: 数据解析
- **getter**: 数据获取器
- **checker**: 数据检查

#### Kubernetes 相关
- **clusterParser**: 集群解析器
- **status**: 状态处理
- **monitoring**: 监控工具
- **workloads**: 工作负载工具

#### 通用工具
- **common**: 通用函数
- **time**: 时间处理
- **base64**: Base64 编码
- **yaml**: YAML 处理
- **cookie**: Cookie 管理

### 4. 状态管理 (Stores)

#### 核心资源
- **pod**: Pod 资源管理
- **deployment**: Deployment 管理
- **service**: Service 管理
- **configmap**: ConfigMap 管理
- **secret**: Secret 管理

#### 集群管理
- **cluster**: 集群管理
- **node**: 节点管理
- **namespace**: 命名空间管理

#### 应用管理
- **apps**: 应用管理
- **devops**: DevOps 管理
- **marketplace**: 应用商店

#### 监控和运维
- **monitoring**: 监控数据
- **event**: 事件管理
- **log**: 日志管理

## 依赖关系

### 核心依赖
- **@tanstack/react-table**: 表格组件库
- **axios**: HTTP 客户端
- **zustand**: 状态管理
- **react-markdown**: Markdown 渲染
- **xterm**: 终端模拟器

### 对等依赖
- **@kubed/charts**: 图表组件
- **@kubed/code-editor**: 代码编辑器
- **@kubed/log-viewer**: 日志查看器

## 使用场景

### 1. Kubernetes 资源管理
```tsx
import { DataTable, StatusIndicator, useList } from '@ks-console/shared';

// 管理 Pod 列表
const PodList = () => {
  const { data, loading } = useList('pods');
  
  return (
    <DataTable
      data={data}
      loading={loading}
      columns={[
        { key: 'name', title: '名称' },
        { key: 'status', title: '状态', render: (status) => <StatusIndicator status={status} /> }
      ]}
    />
  );
};
```

### 2. 工作空间管理
```tsx
import { WorkspaceLayout, useWorkspaceSelect } from '@ks-console/shared';

// 工作空间布局
const WorkspaceApp = () => {
  const { workspace } = useWorkspaceSelect();
  
  return (
    <WorkspaceLayout workspace={workspace}>
      {/* 工作空间内容 */}
    </WorkspaceLayout>
  );
};
```

### 3. 模态框操作
```tsx
import { useModal, Confirm, EditYamlModal } from '@ks-console/shared';

// 使用模态框
const App = () => {
  const { openModal } = useModal();
  
  const handleDelete = () => {
    openModal(Confirm, {
      title: '确认删除',
      content: '确定要删除这个资源吗？',
      onConfirm: () => {
        // 删除逻辑
      }
    });
  };
  
  const handleEditYaml = () => {
    openModal(EditYamlModal, {
      yaml: resourceYaml,
      onSave: (newYaml) => {
        // 保存逻辑
      }
    });
  };
};
```

## 最佳实践

### 1. 组件使用
- 优先使用库提供的组件，避免重复造轮子
- 利用组件的 TypeScript 类型定义，确保类型安全
- 遵循组件的 API 设计，保持一致性

### 2. 状态管理
- 使用 `useList` 管理列表数据，自动处理分页和搜索
- 利用 `useModal` 统一管理模态框状态
- 合理使用缓存，提升用户体验

### 3. 工具函数
- 使用内置的格式化函数处理数据展示
- 利用 API 工具函数处理网络请求
- 使用验证函数确保数据正确性

### 4. 性能优化
- 合理使用 `useMemo` 和 `useCallback`
- 避免在渲染函数中创建新对象
- 使用虚拟滚动处理大量数据

## 扩展开发

### 1. 自定义组件
```tsx
import { BaseTable } from '@ks-console/shared';

// 基于基础组件开发自定义组件
const CustomTable = (props) => {
  return (
    <BaseTable
      {...props}
      // 自定义配置
    />
  );
};
```

### 2. 自定义 Hook
```tsx
import { useList } from '@ks-console/shared';

// 基于基础 Hook 开发自定义 Hook
const useCustomList = (resource) => {
  const listHook = useList(resource);
  
  // 自定义逻辑
  return {
    ...listHook,
    // 扩展功能
  };
};
```

## 总结

`@ks-console/shared` 是一个功能完整、设计良好的 Kubernetes 管理组件库，为 KubeSphere 平台提供了强大的基础能力。通过合理使用该库的组件、Hooks 和工具函数，可以快速构建高质量的 Kubernetes 管理界面，提升开发效率和用户体验。

该库不仅提供了丰富的功能，还具有良好的可扩展性，支持根据具体需求进行定制和扩展。无论是构建新的管理界面，还是扩展现有功能，`@ks-console/shared` 都是一个值得信赖的选择。 